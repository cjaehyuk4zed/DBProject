<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <!-- Google Material Icons -->
    <link
            href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
            rel="stylesheet">

    <title> userProfile </title>
</head>

<style>
    .floating_form {
        margin: 0px 30px;
    }

    .floating_label {
        margin-top: -4px;
        font-size: 14px;
    }

    .floating_input {
        height: 50px;
        padding-top: 20px;
        font-size: 14px;

    }

    .link_txt {
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        overflow: clip;
        text-decoration: none;
    }

    .feed_name_txt {
        font-size: 40px;
        padding: 0px 10px;
        font-weight: bold;
    }
</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <span class="feed_name_txt"> 회원 정보 </span>
        <div>
            <a class="link_txt" th:href="@{'/dborch/main/user/' + ${userInfo.getUid()}}">홈 화면</a>
            <a><span class="material-icons">home</span></a>
        </div>
    </div>
</nav>

<div style="display: flex; justify-content: center; padding-top: 50px">
    <div style="background-color: #fff8e7;margin-right: 1025px; width: 350px; height: 600px; position: fixed;border: 1px solid black;border-radius: 30px;">
        <a style="padding-left: 20px;height: 30px;font-size: 20px;font-weight: bold; cursor: pointer; text-decoration: none;">
            기존 정보 </a>

        <!-- 사용자 현재 프로필 정보 -->
        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 성 : <span th:text="${userInfo.getLname()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 이름 : <span th:text="${userInfo.getFname()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 이메일 : <span th:text="${userInfo.getEmail()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 생일 : <span th:text="${userInfo.getBdate()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 성별 : <span th:text="${userInfo.getGender()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 악기 : <span th:text="${userInfo.getInstrument()}"></span></a>
        </div>

        <div class="form-floating mb-2 floating_form">
            <a style="font-size: 16px;font-weight: bold;"> 전화 번호 : <span th:text="${userInfo.getPhone_no()}"></span></a>
        </div>
    </div>
    <form id="userInfo" name="userInfo" th:object="${userInfo}" onsubmit="submitForm()">
        <div style="background-color: #fff8e7; width: 600px; height: 600px;left: 28%; position: fixed;border: 1px solid black;border-radius: 30px;">
            <p style="margin-left:200px">
                <a style="font-size: 20px;font-weight: bold; cursor: pointer; text-decoration: none;"> 정보 수정 </a>
            <div style="font-size: 14px;text-align: center;width: 50%;min-height: 68vh;display: flex; flex-direction: row; align-items: center; justify-content: center">
                <div class="container; background-color: white; width: 480px; margin: 10px; min-height: auto;">
                    <div class="form-floating mb-2 floating_form">
                        <input type="text" id="lname" name="lname"
                               class="floating_input form-control" placeholder="gong">
                        <label for="lname" class="floating_label">성</label>
                    </div>

                    <div class="form-floating mb-2 floating_form">
                        <input type="text" id="fname" name="fname"
                               class="floating_input form-control"
                               placeholder="jong hyuk">
                        <label for="fname" class="floating_label">이름</label>
                    </div>


                    <div class="form-floating mb-2 floating_form">
                        <input type="text" id="email" name="email"
                               class="floating_input form-control"
                               placeholder="name@example.com">
                        <label for="email" class="floating_label">이메일 주소</label>
                    </div>

                    <!--  type="DATE" 사용-->
                    <div class="form-floating mb-3 floating_form">
                        <input type="date" id="bdate" name="bdate"
                               class="floating_input form-control"
                               placeholder="xxxx-xx-xx">
                        <label for="bdate" class="floating_label">생일</label>
                    </div>

                    <div class="form-floating mb-2 floating_form">
                        <input type="text" id="gender" name="gender"
                               class="floating_input form-control" placeholder="남성">
                        <label for="gender" class="floating_label">성별</label>
                    </div>

                    <div class="form-floating mb-3 floating_form">
                        <input type="text" id="instrument" name="instrument"
                               class="floating_input form-control"
                               placeholder="Violin">
                        <label for="instrument" class="floating_label">악기</label>
                    </div>

                    <div class="form-floating mb-3 floating_form">
                        <input type="text" id="phone_no" name="phone_no"
                               class="floating_input form-control"
                               placeholder="01012341234">
                        <label for="phone_no" class="floating_label">전화 번호</label>
                    </div>

                    <!--hidden 속성으로 사용자 화면에 안보이게하고, userInfo.getUid값을 id="uid"에 저장-->
                    <!--밑에 <script>부분에 이 값을 id="uid"를 통해 전달하는 방식-->
                    <div>
                        <input type="hidden" id="uid" name="uid" th:value="${userInfo.getUid()}">
                    </div>

                    <div>
                        <input type="hidden" id="pw" name="pw" th:value="${userInfo.getPw()}">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 76%"> 변경사항 저장</button>

                </div>
            </div>
        </div>
    </form>
</div>

<script>
    function submitForm() {
        const form = {
            // document에서 변경 사항 값 받아오기 & hidden값에 저장한 userInfo값들 받아오기
            uid: document.getElementById("uid").value,
            fname: document.getElementById("fname").value,
            lname: document.getElementById("lname").value,
            email: document.getElementById("email").value,
            bdate: document.getElementById("bdate").value,
            gender: document.getElementById("gender").value,
            instrument: document.getElementById("instrument").value,
            phone_no: document.getElementById("phone_no").value,
            pw: document.getElementById("pw").value
        };

        const queryUrl = "/api/user/info/" + document.getElementById("uid").value + "/update";
        const xhr = new XMLHttpRequest();
        xhr.open("PUT", queryUrl, true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        xhr.onload = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status >= 200 && xhr.status < 300) {
                    window.location.reload();
                } else {
                    alert(xhr.statusText);
                    alert("Error updating user");
                    document.getElementById("response").innerHTML = xhr.responseText;
                }
            }
        };
        xhr.send(JSON.stringify(form));
    }
</script>
